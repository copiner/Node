<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>WebSocket Echo Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link href="common/bootstrap.min.css" rel="stylesheet" />
<script src="common/jquery.min.js"></script>
<script src="common/bootstrap.min.js"></script>
<script>
if (window.WebSocket){
  console.log("This browser supports WebSocket!");
} else {
  console.log("This browser does not support WebSocket.");
}
//建立连接
var ws = new WebSocket("ws://localhost:8081");
ws.onopen = function (e) {
    console.log('Connection to server opened');
    sendsth();
}
var flag = 0;

function sendsth(){
    var rannum = Math.floor(Math.random()*10);
    if (ws.readyState === window.WebSocket.OPEN){
      if(flag < 5){
        flag++;
        ws.send(JSON.stringify({
            "num": rannum
        }));
      }
    }
}
//收到消息处理
ws.onmessage = function (e){
    var data = JSON.parse(e.data);
    console.log(data);
    //console.log(flag);
    sendsth();
}
//异常处理
ws.onerror = function(e){
  console.log("WebSocket Error: " , e);
};

ws.onclose = function (e){
    console.log("Connection closed");
}

function disconnect(){
    ws.close();
}
</script>
</head>

<body >
<h3>WebSocket</h3>
</body>
</html>
